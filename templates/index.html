<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Lightning Out – Record Viewer</title>
</head>
<body>
  <div id="status" style="font:14px/1.4 system-ui, sans-serif; padding:12px"></div>
  <div id="lo-container"></div>

  <script>
	const baseLightningUrl = "https://s11g0--core.sandbox.my.site.com/recordviewerapp";
	const appName = "c:SIIGO_OutUiRecordViewerApp_AUR";
	const rootEl = "lo-container";

	function log(msg, isErr){
		const el = document.getElementById('status');
		el.textContent = (isErr ? "⚠️ " : "✅ ") + msg;
		if(isErr) el.style.color = "#b00020";
	}

	function loadLightningOut() {
		return new Promise((resolve, reject) => {
			const s = document.createElement('script');
			s.src = `${baseLightningUrl}/lightning/lightning.out.js`;
			s.onload = resolve;
			s.onerror = () => reject(new Error("No se pudo cargar lightning.out.js"));
			document.head.appendChild(s);
		});
	}

	async function init() {
		try {
			const recordId   = "{{ record_id }}";
			await loadLightningOut();
			$Lightning.use(
				appName,
				() => {
					$Lightning.createComponent(
						"c:SIIGO_UiRecordViewerHost_AUR",
						{recordId: recordId},
						rootEl,
						() => log("Lightning Out inicializado.")
					);
				},
				baseLightningUrl,
				null // guest: sin token
			);
			// Fallback manual si no llama en 15s:
			setTimeout(() => log("Timeout inicializando Lightning Out.", true), 15000);
		} catch (e) {
			log("Error: " + e.message, true);
			console.error("Lightning Out ERROR:", e);
		}
	}
	init();
  </script>
</body>
</html>
